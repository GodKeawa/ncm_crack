# NCM 文件解密工具

将网易云音乐加密的 `.ncm` 文件转换为标准音频格式（MP3/FLAC），并保留完整的元数据和专辑封面。支持递归处理文件夹，完整保留目录结构。

## 功能特性

- **自动格式识别**：根据文件头自动检测输出格式（MP3 或 FLAC）
- **完整元数据**：自动提取并写入歌曲名、艺术家、专辑、年份等信息
- **专辑封面**：自动下载并嵌入专辑封面图片
- **多格式支持**：同时支持 MP3 和 FLAC 格式的元数据写入
- **递归目录处理**：自动遍历所有子文件夹，发现所有 NCM 文件
- **保留目录结构**：在输出文件夹中完整复制输入文件夹的目录结构
- **智能文件处理**：
  - NCM 文件自动转换为 MP3/FLAC
  - 其他文件（图片、文本等）直接复制到对应位置
- **批量转换**：支持目录批量转换，自动跳过已转换文件
- **多线程处理**：利用多核 CPU 提升转换速度（默认使用 100% CPU 核心）
- **黑名单机制**：跳过特定文件夹（如系统文件夹、缓存等）
- **覆写模式**：支持重新处理已存在的文件，用于库更新和元数据修正

## 使用方法

### 基本用法

```bash
# 使用默认路径（./Music -> ./Output）
python ncm_crack.py

# 指定输入文件夹
python ncm_crack.py -p ./MyMusic

# 同时指定输入和输出文件夹
python ncm_crack.py -p ./MyMusic -o ./ConvertedMusic

# 启用覆写模式（重新处理已存在的文件）
python ncm_crack.py -f

# 组合使用
python ncm_crack.py -p ./Music -o ./Output -b demo test -f
```

### 参数说明

- `-p, --path`：输入目录路径（默认：`./Music`）
- `-o, --output`：输出目录路径（默认：输入目录同级的 `Output` 文件夹）
- `-b, --blacklist`：要跳过的文件夹名称列表（空格分隔）
- `-f, --overwrite`：覆写已存在的文件（用于库更新和元数据修正）


### 黑名单机制

默认跳过以下文件夹：
- 系统文件夹：`__pycache__`, `.git`, `.svn`, `.hg`, `.idea`, `.vscode`
- 依赖文件夹：`node_modules`
- 输出目录：`Output`

可通过 `-b` 参数添加自定义黑名单文件夹。


## 依赖说明

主要依赖库：
- `pycryptodome` - AES 解密算法
- `mutagen` - 音频元数据处理（支持 MP3 和 FLAC）
- `eyed3` - MP3 标签支持
- `requests` - 专辑封面下载
- `tqdm` - 进度条显示
- `psutil` - CPU 使用率监控

安装依赖：
```bash
uv sync
```
